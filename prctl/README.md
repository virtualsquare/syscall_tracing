# prctl `PR_SET_SYSCALL_USER_DISPATCH`

## prctl `PR_SET_SYSCALL_USER_DISPATCH` details

* self-virtualization

* syscall event notification via: SIGSYS. Args retrieved from siginfo's handler third
argument (ucontext).

* deeply arch dependent

* thread safe (must be activated at each thread)

* designed for foreign OS emulation (e.g. Wine or limbo for XNU).


The code of this example includes a trick to capture all the syscall 
generated by glibc: it reads the restorer addr from the sigaction structure
(defining sigation twice, the second time read the restorer addr from the
 `old`	 action).

## examples:

Compile:
```
$ make
```
`prctl_purelibc_virt` copies the file whose pathname is the first arg to stdout.
```
./prctl_purelibc_virt /etc/passwd
```
the contents of /etc/hostname will be printed instead

`prctl_purelibc_virtlib` works as a preloaded library:
```
make install
LD_PRELOAD=/tmp/prctl_purelibc_virtlib.so cat /etc/passwd
```
prints the contents of /etc/hostname

### cleaning

```
make uninstall
make clean
```


